class Cart{constructor(t,a=".cart__drop-box"){this.source=t,this.container=a,this.countGoods=0,this.amount=0,this.cartItems=[],this._init()}_init(){this._render(),fetch(this.source).then(t=>t.json()).then(t=>{for(let a of t.contents)this.cartItems.push(a),this._renderItem(a);this.countGoods=t.countGoods,this.amount=t.amount,this._renderSum(),"Shopping Cart"===$("title").text()&&this._mainCart()})}_render(){let t=$(".cart__drop-flex"),a=$("<div/>",{class:"total"});a.append($("<span>ToTAl</span>")),a.append($('<span class="sum-price"></span>')),a.appendTo($(t))}_renderItem(t){let a=$("<div/>",{class:"drop-row","data-product":t.id_product}),s=$("<div/>",{class:"drop-img"});s.append($(`<img src=${t.src} width="72px" height="85px">`)),s.appendTo($(a));let p=$("<div/>",{class:"drop-description"});p.append($(`<h3 class="drop-h3">${t.product_name}</h3>`));let e=$("<div/>",{class:"rate-box"});e.append($('<i class="fas fa-star"></i>')),e.append($('<i class="fas fa-star"></i>')),e.append($('<i class="fas fa-star"></i>')),e.append($('<i class="fas fa-star"></i>')),e.append($('<i class="fas fa-star-half-alt"></i>')),e.appendTo($(p));let i=$("<div/>",{class:"drop-p"});i.append($(`<span class="product-quantity">${t.quantity} x </span>`)),i.append($(`<span class="cart-price">&#36;${t.price}</span>`)),i.appendTo($(p)),p.appendTo($(a));let d=$("<div/>",{class:"drop-del"});d.append($('<i class="fas fa-times-circle"></i>')),d.appendTo($(a)),d.click(()=>{this._remove(t.id_product)}),a.prependTo($(".cart__drop-flex"))}_mainCart(){if(this.cartItems.length>0)for(let t of this.cartItems){let a=$(".cart-wrapper"),s=$("<div/>",{class:"shop-list-row","data-product":`${t.id_product}`}),p=$('<div class="shop-list-row__item"></div>'),e=$('<a href="single_page.html"></a>');e.append(`<img class="shop-list-row__img" src="${t.src}" alt="Product photo">`);let i=$('<div class="shop-list-row__info"></div>'),d=$('<a href="single_page.html"></a>');d.append(`<h3>${t.product_name}</h3>`);let r=$('<div class="box-rate"></div>'),o=$('<div class="shop-list-row__rate"></div>');o.append('<i class="fas fa-star"></i>'),o.append('<i class="fas fa-star"></i>'),o.append('<i class="fas fa-star"></i>'),o.append('<i class="fas fa-star"></i>'),o.append('<i class="fas fa-star"></i>'),o.appendTo($(r)),i.append($(d)),i.append($(r)),i.append("<p><span>Color: </span>Red</p>"),i.append("<p><span>Size: </span>Xll</p>"),p.append($(e)),p.append($(i));let n=$('<div class="shop-list-row__price"></div>');n.append(`<p>$${t.price}</p>`);let c=$('<div class="shop-list-row__quantity"></div>'),l=$('<form action="#"></form>'),u=$("<input/>",{type:"number",class:"input-quantity",min:1,value:`${t.quantity}`,title:"#"});u.on("input",()=>{u.val()>t.quantity?(t.quantity++,this.amount+=t.price,this.countGoods++):(t.quantity--,this.amount-=t.price,this.countGoods--),this._renderSum(),this._updateCart(t)}),u.appendTo($(l)),l.appendTo($(c));let h=$('<div class="shop-list-row__shipping"></div>');h.append("<p>free</p>");let m=$('<div class="shop-list-row__subtotal"></div>');m.append(`<p class="product-subtotal">$${t.price*t.quantity}</p>`);let _=$('<div class="shop-list-row__action drop-del"></div>');_.click(()=>{this._remove(t.id_product)}),_.append('<i class="fas fa-times-circle"></i>'),s.append($(p)),s.append($(n)),s.append($(c)),s.append($(h)),s.append($(m)),s.append($(_)),s.appendTo($(a));let f=$("<hr/>",{class:"cart-line","data-product":`${t.id_product}`});a.append($(f))}}_renderSum(){0===this.countGoods?($(".cart-outCount").removeClass("no-empty"),this._emptyMassage()):$(".cart-outCount").addClass("no-empty"),$(".outCount").text(`${this.countGoods}`),$(".sum-price").text(`$${this.amount}`),$(".grand-total").text(`$${this.amount}`),$(".sub-total").text(`$${this.amount}`)}_updateCart(t){console.log(t);let a=$(`div[data-product="${t.id_product}"]`);a.find(".cart-price").text(`$${t.price}`),a.find(".product-quantity").text(`${t.quantity} x `),$(`div[data-prod="${t.id_product}"]`).find(".product-subtotal").text(`${t.quantity*t.price}`)}addProduct(t){let a=+$(t).data("id"),s=this.cartItems.find(t=>t.id_product===a);if(s)s.quantity++,this.countGoods++,this.amount+=s.price,this._updateCart(s);else{let s={id_product:a,product_name:$(t).data("name"),price:+$(t).data("price"),quantity:1,src:$(t).data("src")};this.cartItems.push(s),this._renderItem(s),this.amount+=s.price,this.countGoods+=s.quantity}this._renderSum()}_remove(t){let a=this.cartItems.find(a=>a.id_product===t);a.quantity>1?(a.quantity--,this._updateCart(a)):(this.cartItems.splice(this.cartItems.indexOf(a),1),$(`[data-product="${t}"]`).remove()),this.countGoods--,this.amount-=a.price,this._renderSum()}_emptyMassage(){$(".empty-wrapper").remove(),$(".cart-wrapper").append('<div class="empty-wrapper"><span class="empty-text">EMPTY SHOPPING CART</span></div>')}removeAll(){let t=$(".shop-list-row:not(:first)"),a=$(".cart-line:not(:first)");t.remove(),a.remove(),this._emptyMassage(),$(".drop-row").remove(),this.countGoods=0,this.amount=0,this.cartItems=[],this._renderSum()}}